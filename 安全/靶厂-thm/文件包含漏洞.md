### 一、什么是文件包含漏洞？
> 应用程序通过参数访问给定系统上的文件，且验证不严谨或者没有时导致漏洞存在
```shell
### 漏洞类型
# 远程文件包含(RFI，Remote File Inclusion): 通过url等协议读取远程文件
# 本地文件包含(LFI，Local File Inclusion):读取服务器本地的文件

### 漏洞存在位置:GET请求、POST请求及cooike等都有可能，通常为file=name模式
### 危害
# 写入后门
# 获取敏感数据
# RCE
```

### 二、本地文件包含
```php
# 常规加载，传递payload为`/etc/passwd`即可验证
<?PHP 
	include($_GET["lang"]);
?>
```

```php
# 存在固定目录，传递payload为`../../../../etc/passwd`即可验证
<?PHP 
	include("languages/". $_GET['lang']); 
?>
```

```shell
### 绕过及处理
# 添加文件后缀：添加截断符%00
# 关键文件过滤：利用. 和 .. 的配合避免被过滤，如/etc/passwd改为/etc/./passwd
# 特殊字符过滤：重写绕过
```

### 三、远程文件包含
```shell
### 跟本地文件包含一致，但是参数选择其他web页面
# 特点
# 可以利用该漏洞写入后门
# 需要开通特点服务
```

### 四、查找漏洞过程
```shell
    1. Keep system and services, including web application frameworks, updated with the latest version.
    2. Turn off PHP errors to avoid leaking the path of the application and other potentially revealing information.
    3. A Web Application Firewall (WAF) is a good option to help mitigate web application attacks.
    4. Disable some PHP features that cause file inclusion vulnerabilities if your web app doesn't need them, such as allow_url_fopen on and allow_url_include.
    Carefully analyze the web application and allow only protocols and PHP wrappers that are in need.
    5. Never trust user input, and make sure to implement proper input validation against file inclusion.
    6. Implement whitelisting for file names and locations as well as blacklisting.
```
