### 一、漏洞原理
web程序没有严格控制上传的文件类型或者处理不当，导致用户可以上传payload文件，从而达到攻击目的。
### 二、存在条件

1. 上传控制不够严谨且没有对文件进行处理
2. 展示文件上传位置
3. 文件位置没有独立出来
### 三、漏洞利用

1. 根据web程序执行语言编写后门文件，例如：
```shell
echo "<?php @eval($_POST[pass]);?>" >> shell.php
```

2. 上传shell.php到服务器后台，并根据获取的上传路径拼接链接
3. 使用中国菜刀连接
### 四、漏洞绕过

1. 前端对文件类型进行控制
> 通过burpsuite截取数据包，并更改Content-Type类型从而绕过


2. 对文件类型及后缀进行控制
> 通过burpsuite以及后缀名修改绕过控制从而上传到服务器，并利用其他漏洞对文件名进行更改


### 五、漏洞绕过分类
![ae3ga1i6gu.png](https://cdn.nlark.com/yuque/0/2022/png/32589116/1664094766112-fde65c0c-8f19-4145-8061-9c12384059d2.png#clientId=uc66045a5-d956-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=458&id=u50db9878&margin=%5Bobject%20Object%5D&name=ae3ga1i6gu.png&originHeight=573&originWidth=800&originalType=binary&ratio=1&rotation=0&showTitle=false&size=487897&status=done&style=none&taskId=u8c6f1eb6-e3a8-44da-9cbb-b03d4ba51e6&title=&width=640)
### 六、漏洞防御

1. 从前后端对上传文件的文件类型、后缀以及文件名进行限制
2. 严格限制上传目录的位置
3. 对上传文件进行修改，比如重命名、压缩等
4. 对上传文件的目录服务器跟web服务器进行隔离，并只授予只读权限
