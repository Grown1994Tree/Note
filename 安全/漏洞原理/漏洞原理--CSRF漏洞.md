### 一、漏洞原理
通过利用服务器未失效的会话(ssesion)，伪造链接诱使用户点击或下载，从而借用用户的身份(cookie)向服务器发送请求，从而实现攻击。
### 二、存在条件

- 链接可预设
- refer没有限制
- 没有token
### 三、漏洞挖掘

1. 寻找有价值的地方，例如转账、更改地址等需要用户确认身份的地方
2. 对访问进行抓包，判段是否存在token
3. 如果请求包不包含token,通过更改请求包的refer,如果更改前后一致且refer可以绕过则判定存在csrf漏洞
### 四、攻击方式

1. 诱使用户点击构建的url链接，从而传递payload，达到实现csrf攻击的目的
2. 构建网站，诱使用户点击网站提供的按钮，从而传递payload，达到实现csrf攻击的目的
3. 把payload构造成图片链接，利用img元素会在加载时自动访问链接从而达到csrf攻击
### 五、防御

1. 通过对refer进行判断，如果请求包的来源不符合要求则pass掉
> 局限性：对于部分业务来说，比如营销网站等，限定访问来源会影响业务发展，所以使用refer进行防护性价比较低
> 
> 绕过方案：根据判定方法，通过在_/etc/hosts_文件里面伪造域名以及访问路径从而构筑符合要求的_refer_的路径，对refer判断进行绕过


2. 设置token,访问时带上唯一token
> 使用方法：每次访问网站时，都会在页面重置一个token，每次访问时都带上token,如果符合则认为是正常的用户访问，token不能放在cookie里面。对于重要业务，则可以配合上refer来源判断


3. 其他校验方式，如手机验证码等
