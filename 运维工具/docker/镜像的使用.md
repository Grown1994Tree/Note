# 镜像

### 镜像的使用？

1. 查看本地镜像版本：`docker images`
![avatar](/运维工具/docker/docker_images.png)

- REPOSITORY：表示镜像的仓库源
- TAG：镜像的标签
- IMAGE ID：镜像ID
- CREATED：镜像创建时间
- SIZE：镜像大小

2. 运行镜像：`docker run [参数]（仓库源）:（版本）`

3. 从线上仓库拉取镜像：`docker pull ubuntu:13.10`

4. 查找镜像：`docker search (镜像)`
![avatar](/运维工具/docker/docker_search.png)

- NAME: 镜像仓库源的名称
- DESCRIPTION: 镜像的描述
- OFFICIAL: 是否 docker 官方发布
- stars: 类似 Github 里面的 star，表示点赞、喜欢的意思。
- AUTOMATED: 自动构建。

5. 镜像删除：`docker rmi (镜像)` *<font size=2>如果该镜像已经形成容器，则删除时需要先删除掉容器，再删除掉镜像</font>*

6. 镜像设置标签：`docker tag （镜像ID） (镜像名)[:标签名]`

### 镜像的生成？

1. 使用现有容器生成

- 找到任意一个容器，并对其进行修改
- 使用`sudo docker commit -m="has updated" -a="sjy" （容器ID） （镜像名）:（镜像标签）`
  - -m: 提交的描述信息
  - -a: 指定镜像作者

实例：

```
    FROM nginx
    RUN echo '<h1> Hello,Docker!</h1>' >/usr/share/nginx/html/index.html
```

2. 使用dockerfile文件
主要有两个命令：`FROM`和`RUN`
`FROM （镜像）`：下载镜像，docker官方提供了一系列优秀的镜像，选择最适合的镜像进行编辑改造。
`RUN 指令`：在`FROM`下载的镜像里面，使用`RUN`指令进行构造。
通过上面两个指令，在dockerfile生成新的镜像，然后再使用`sudo docker build (路径|url) -t nginx:v3`创建新的镜像。
其他命令：
    - `COPY (源路径) (目标路径)`

    ```
        FROM nginx
        COPY ./a.txt /a.txt
        RUN echo '<h1> Hello,Docker!</h1>' >/usr/share/nginx/html/index.html
    ```

    - `ADD (源路径) (目标路径)`  *<font size=2>语法和COPY类似，但对于使用`tar`压缩的文件会自动解压</font>*
    - `WORKDIR (目录)` 设置工作目录
    - `SEV` 设置运行环境
    - `CMD` 运行时执行程序，在`docker run`阶段执行，只执行最后一个`CMD`.相当于在容器运行时的初始化。

    ```
        FROM nginx
        CMD /bin/bash   #镜像运行时立即执行
        RUN echo '<h1> Hello,Docker!</h1>' >/usr/share/nginx/html/index.html
    ```

    - `ENTRYPOINT`:功能跟`CMD`类似
    - `ENV`：设置容器环境变量

    ```
        FROM nginx
        ENV a=6 b=99
        CMD /bin/bash
        RUN echo '<h1> Hello,Docker!</h1>' >/usr/share/nginx/html/index.html
    ```

    - `ARG` 设置环境变量，但是只保存在`docker build`阶段
    - `VOLUME` 挂载路径，容器运行时，可以通过`-v`指定挂载目录
