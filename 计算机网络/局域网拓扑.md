### 交换机部分

### 局域网拓扑

# 拓扑图
定义：由点、线组成，用来对网络的节点的抽象。

# 三层网络设计模型
1. 三层结构：
    - 接入层：直接跟终端连接
    - 汇聚层：策略设置
    - 核心层：数据转发
2. 设计原则
    - 带宽冗余和链路冗余
    - 结构对称和缩短链路


### 以太网

# 集线器时期
1. 特点：
    - 集线器拥有多个端口，但是共用同一个数据信道
    - 可能会形成冲突。

2. 集线器冲突解决方案：CSMA/CD（Carrier sense multiple access with collision detection：带冲突检测的载波侦听多路访问机制）
3. CSMA/CD原理：
    - 应用于物理层
    - 每个发送端口持续对信道进行监听，信道空闲时才进行发送。
    - 通过信道的电压高低来判断信道是否空闲。
    - 距离过长导致接收延时，可能会导致多个端口同时发送，造成冲突。

# 交换机时期
1. 特点：
    - 应用于数据链路层
    - 每个端口单独隔离成一个冲突域
    - 以帧为单位进行传播
    - 采用MAC地址进行寻址。
    - 会形成一个MAC地址表或内容可寻址内存(CAM)表,用来表达端口与MAC地址的联系。
2. 帧传播方式：
    - 单播：发送方和接收方一对一
    - 组播：发送方和接收方一对多
    - 广播：向所有接收方进行发送

3. 交换机原理：
    - 接收到数据帧时，在MAC地址表对源MAC地址进行查询
        - 若源MAC地址存在，则进行重置
        - 若源MAC地址不存在，则建立对应关系
    - 接收到数据帧时，在MAC地址表对目的MAC地址进行查询
        - 若目的MAC地址存在，则向对应端口转发数据
        - 若目的MAC地址不存在，则对所有非源端口进行广播，并记录响应的端口
    
4. 邻近发现协议：
    - 邻近发现协议包含CDP协议、LLDP协议。
    - CDP协议只能发现思科的设备，无法兼容其他设备，LLDP协议可以兼容。

5. 缺点：
    - 广播域的增加导致广播风暴
    - 缺乏安全性且不好管理
    - 工作组之间的切换较为麻烦

### 虚拟局域网
1. 特点：
    - 缩小了广播风暴的规模
    - 减轻了主干网的压力，使网络更加通畅。
    - 减少了访问量，更加安全
    - 便于管理

2. Trunk模式
    - 通过对数据帧添加vlan信息，来创建跨多个交换机的虚拟局域网。
    - 使用`IEEE802.1Q`协议和`ISL`协议，`ISL`协议为思科故有协议，无法兼容其他品牌设备。
    - 通过在MAC源地址和目的地址后面添加vlan信息来实现不同交换机之间的连接
    - 不同链路对应不同的端口模式
        - 接入链路：终端设备跟交换机的直接连接，数据帧无需携带vlan信息
        - 汇聚链路：交换机之间的联系通道，需携带vlan信息
        - 混合链路：可以传输带vlan信息或没有带vlan信息的数据帧，但传播时只能发送单一类型的数据帧
    - 需要到每台交换机去设置虚拟局域网

3. VTP（VLAN Trunking Protocol）功能
    - VTP是 VLAN 中继协议，也被称为虚拟局域网干道协议，属于思科独有。
    - VTP协议具有自主学习功能，只要在服务交换机上面进行配置，其他同域的交换机则会自动学习和转发。
    - 三种身份：
        - 服务器身份：可以在交换机上修改、增加和删除vlan,由其他进行学习和转发
        - 客户端身份：不可以在交换机上修改、增加和删除vlan，只能进行学习和转发
        - 中继身份：可以在交换机上修改、增加和删除vla，但不会被其他交换机学习和转发，同时转发服务器交换机的配置
    - 修剪功能，避免没有必要的广播



### STP协议
1. 背景：为了提高网络的健壮性，需要增加冗余链路，但是冗余链路存在以下几个问题。
    - 广播风暴：冗余链路的增加导致数据帧在信道里面的循环，造成广播分暴。
    - 多帧复用：同一个端口接收了多个相同的数据帧
    - MAC地址飘移和溢出：相同来源的MAC地址但端口却不一致的多个数据帧，会持续修改MAC地址表。

2. STP原理
    - 原理：通过给各个链路设置参考值，选择开销最小的路径作为主链路，其他链路阻塞掉作为冗余链路。
    - 过程：利用生成树（STA）和BPDU协议，选举出根网桥、根端口、指定端口和非指定端口从而确定最优链路。
        - 选举根网桥
            - 各个交换机通过BPDU进行沟通，选择BID最小的值最为根网桥。
            - BID由优先级（2字节）和MAC地址（6字节）组成。
        - 选举根端口（RP）
            - 在非根桥交换机的端口里选择一个离根网桥的交换机路径开销最近的一个端口最为根端口。
            - 选举顺序
                - 比较到根网桥的路径开销，最小为根端口
                - 比较BID（本机以及路径上的交换机）的值，最小为根端口
                - 比较端口ID
        - 选举指定端口（DP）
            - 在非网桥的交换机链路所连接的端口中，选择一个离根网桥的交换机路径开销最近的一个端口最为指定端口。
            - 选举顺序
                - 比较到根网桥的路径开销，最小为根端口
                - 比较BID（本机以及路径上的交换机）的值，最小为根端口
                - 比较端口ID
        - 选举非指定端口，在所有根端口和指定端口都确定后，其他端口都为非指定端口
    - 转发与禁止：所有RP和DP都设置为转发状态，其他端口都设置为阻塞状态

3. STP端口状态与过程
阻塞（Blocking）：端口不能参与其他帧的转发与接收，只接受 BPDU，但不发送，同时不学习 MAC 地址。
侦听（Listening）：端口自阻塞状态后的第一个过渡状态。不能参与其他帧的转发与接收，只接受与发送 BPDU，同时不学习 MAC 地址。
学习（Learning）：处于准备参与帧转发状态，不能参与其他帧的转发与接收，只接受与发送 BPDU，同时学习 MAC 地址。
转发（Forwarding）：端口可以正式转发帧了。
禁止（Disabled）：端口不参与 STP，不收发任何的帧 

### 路由器部分（小型计算机）

1. 路由功能：
    - 数据包分组
    - 数据包转发

2. 转发机制
    - 进程交换：通过CPU对帧的分析，找出对应的端口进行转发
    - 快速交换：在快速交换缓存表中查找之前的转发端口进行转发
    - 思科快速交换：在网络和拓扑创建时，自动建立邻接表和转发信息表，自动建立起最佳转发路径。

### vlan之间的通信
1. 单臂路由：在路由器上的单个物理端口上设置逻辑端口。